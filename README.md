# 1. 项目名称

**摇摇棒**。

---
---

# 2. 清单

硬件版本 V1.0
```
MCU: AT89S52 (1T, 4.0-5.5V, 8K Flash, 256 RAM, 1K EEP)
FOSC: 外部时钟 12.000 MHz 

显示：LED8（16颗）
```

# 3. 目录结构

代码在 ./src 目录下
```
./
├── APP - 程序入口
│   ├── STARTUP.A51
│   ├── main.c
│   └── cfg.h
├── BSP - 板载支持包。bsp_xxx 为BSP各个子模块
│   ├── bsp.c - bsp入口文件
│   ├── bsp.h - bsp入口头文件
│   ├── bsp_led.c
│   ├── bsp_led.h
│   ├── bsp_kbd.c
│   ├── bsp_kbd.h
│   ├── bsp_uart.c
│   └── bsp_uart.h
├── EXT-LIB - 扩展的公共包
│   ├── lib_delay.c - 延迟
│   ├── lib_delay.h
│   ├── lib_math.c - 自定义数学函数
│   ├── lib_math.h
│   ├── lib_stdint.h - C99引入的C标准库，C51没有，这里单独引入
│   ├── lib_util.c - 自定义工具函数
│   └── lib_util.h
```

---
---

# 4. 设计说明

## 4.1 定时器

STC12C5A60S2 共2个定时器/计数器（T0/T1），上电后默认均为12分频。若不分频1T，需要通过 AUXR.7=1 AUXR.6=1 设置。

## 4.4 串口

有两个串口：
+ UART1：波特率发生器支持T1、或独立波特率BRT
+ UART2：波特率发生器只支持独立波特率BRT

因晶振与波特率误差问题，经测试能正常通信的波特率：
+ 12MHz
  + 12T: 1200  2400
  + 1T:  2400  4800  9600  19200
+ 24MHz
  + 1T:  2400  4800  9600  19200  38400  57600

这里选用 `1T 57600` (24M)

# 5. 菜单&功能

按键: `功能` <br>
状态：长按、短按

+ 显示页切换：在`显示`页时，直接短按 `加`/`减` pageN切换；
+ 设置切换：在任意`page显示`页，短按 `功能`，进行 `显示` -> `设置-X` -> `显示` 循环切换；
+ 设置调节：
  + 时间设置页：对应时间数字闪烁显示，短按 `加`/`减` ±1设置数字（秒数值是直接归0）；
  + 日期设置页：对应日期数字闪烁显示，短按 `加`/`减` ±1设置数字；
  + 温度设置页：对应日期数字闪烁显示，短按 `加`/`减` ±1设置数字，长按 `加`/`减` ±10设置数字；


# 9. 问题汇总

**Q1: DS18B20读取温度，MSB、LSB结果都是0xFF** 【已解决】

DS18B20通信严格以来总线时序。为了节省idata空间，将 `Memory Model` 调成 `Large`。导致定义的 `_delay_us(u16 i)` 函数运行时间不准确，声明延迟函数空间改成 `void _delay_us(u16 i) small`。


---
---
